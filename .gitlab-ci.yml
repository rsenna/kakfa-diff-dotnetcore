image: microsoft/dotnet:latest
stages:
- build
- unit-test
- integration-test
before_script:
- 'apt-get update'
- 'apt-get install -y python3-pip'
- 'pip3 install docker-compose'
- 'dotnet restore'
build_job:
  stage: build
  script:
  - 'dotnet build'
  only:
  - master
  artifacts:
    untracked: true
unit_job:
  stage: unit-test
  script:
  - 'find -wholename **/bin/Debug/*Test.Unit.dll | xargs dotnet vstest'
  only:
  - master
  dependencies:
  - build_job
integration_job:
  stage: integration-test
  script:
  - 'docker-compose up'
  - 'find -wholename **/bin/Debug/*Test.Integration.dll | xargs dotnet vstest'
  dependencies:
  - build_job
