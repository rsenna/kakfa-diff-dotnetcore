image: microsoft/dotnet:latest
stages:
- build
- unit-test
- integration-test
before_script:
- 'dotnet restore'
build_job:
  stage: build
  script:
  - 'dotnet build'
  only:
  - master
  artifacts:
    untracked: true
unit_job:
  stage: unit-test
  script:
  - 'find -wholename **/bin/Debug/*Test.Unit.dll | xargs dotnet vstest'
  only:
  - master
  dependencies:
  - build_job
integration_job:
  variables:
    KAFKA_ADVERTISED_HOST_NAME: localhost
    KAFKA_CREATE_TOPICS: "hello-topic:1:1,diff-topic:1:1:compact"
    KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
  services:
  - wurstmeister/zookeeper:3.4.6
  - wurstmeister/kafka:0.11.0.1
  stage: integration-test
  script:
  - 'find -wholename **/bin/Debug/*Test.Integration.dll | xargs dotnet vstest'
  dependencies:
  - build_job
